!function(e){"use strict";var t="datalist",i=300;e.expr[":"].RD_contains=e.expr.createPseudo(function(t){return function(i){return e(i).text().toUpperCase().indexOf(t.toUpperCase())>=0}}),e.fn[t]=function(n){return"hide"===n?this.each(function(){var i=e(this).data(t);i&&i.showList&&i.showList(!1,!0)}):"destroy"===n?this.each(function(){var i=e(this),n=i.data(t);n&&n.$datalist&&(n.$datalist.remove(),i.data(t,null))}):(n=e.extend({fadeOutSpeed:"fast",change:null},n),this.each(function(){function o(e,t){e!==y&&(e?h.show():(t?h.hide():h.fadeOut(n.fadeOutSpeed),v.removeClass("active")),y=e)}function a(e,t){var n=e.offset(),a=e.get(0).getBoundingClientRect(),s=document.querySelector("html").clientWidth,l=document.querySelector("html").clientHeight,c=l-a.bottom-3;return a.right>s||c<a.height?(o(!1),!1):(t.css({left:n.left,top:n.top+a.height,width:a.width,maxHeight:Math.min(c,i)+"px"}),!0)}function s(t){var i;a(d,h)&&(r=arguments.length?t:d.val(),i=h.find("li:RD_contains('"+r+"')"),i.length?(v.each(function(t,n){i.index(n)>-1?e(n).show():e(n).hide().removeClass("active")}),o(!0)):o(!1))}function l(e){"function"==typeof n.change&&n.change.call(d,e)}var c,r,u,d=e(this),f=d.attr("list"),h=e("#"+f),v=h.find("option"),p=0,g=document.createDocumentFragment(),m=null,C={},y=!1;e("ul#"+f).is(h)||(e("<ul />",{"class":"datalist",id:f}).appendTo("body"),h.remove(),["fontFamily","fontSize"].forEach(function(e){C[e]=d.css(e)}),h=e("#"+f).css(C),v.each(function(){m=e("<li />",{text:e(this).val()})[0],g.appendChild(m)}),h.append(g)),v=h.find("li"),d.on("focus",function(){h.scrollTop(0),p=0,s()}).on("blur",function(){setTimeout(function(){o(!1)},500)}).on("keydown",function(e){var t,i,n;if(13!==e.keyCode){if(27!==e.keyCode){if(9===e.keyCode)return void o(!1);if(y||s(),y){if(38===e.keyCode)return t=h.find("li.active"),t.length&&(c=t.prevAll("li:visible"),c.length>0&&(t.removeClass("active"),c.eq(0).addClass("active")),c.length&&c.position().top<0&&p>0&&h.scrollTop(p-=v.outerHeight())),u=!0,!1;if(40===e.keyCode){if(t=h.find("li.active"),t.length){i=h.outerHeight(),n=v.outerHeight();var a=t.nextAll("li:visible");a.length>0&&(t.removeClass("active"),a.eq(0).addClass("active")),a.length&&a.position().top+n>=i&&h.stop().animate({scrollTop:p+=n},200)}else v.removeClass("active"),h.find("li:visible:first").addClass("active");return u=!0,!1}}}else if(y)return o(!1),u=!0,!1}else if(y&&(t=h.find("li.active"),t.length&&(d.val(t.text()),l(t.text())),o(!1),13===e.keyCode))return u=!0,!1}).on("keyup",function(){var e;if(u)return r=d.val(),u=!1,!1;if((e=d.val())!==r){if(s(e),!y)return;v.removeClass("active"),h.find("li:visible:first").addClass("active"),h.scrollTop(0),p=0}}),v.on("mouseenter",function(){e(this).addClass("active").siblings().removeClass("active")}).on("mouseleave",function(){e(this).removeClass("active")}).on("click",function(){var t=e("li.active");t.length&&d.val(e(this).text()),o(!1),l(e(this).text())}),e(window).resize(function(){a(d,h)}),d.data(t,{$datalist:h,showList:o})}))}}(jQuery);